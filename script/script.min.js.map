{"version":3,"sources":["script.js"],"names":["window","unnuo","main","_n","_min","_max","this","n","min","max","result","prototype","getRandomNumber","Math","random","checkNumber","num","i","length","getNNumber","push","Random","Mine","callback","number","isMine","opened","row","col","htmlDOM","document","createElement","className","mineSweep","_times","_container","_newBtn","_saveBtn","history","JSON","parse","localStorage","getItem","times","bombArray","openedAmount","opendAmount","canplay","console","log","array","container","getElementById","newBtn","saveBtn","gameWidth","innerWidth","size","style","innerHTML","head","appendChild","mineAmount","AMOUNT","createGameData","r","c","mine","createHistoryGameData","createMinePosition","round","calculateAround","temp","j","sweep","point","alert","handle","_this","addEventListener","bind","render","onclick","removeItem","setItem","stringify"],"mappings":"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","file":"script.min.js","sourcesContent":["window.unnuo = window.unnuo || {};\r\n(function() {\r\n\r\n    // 传入一个参数n。生成n个1-31的随机数，且不重复\r\n    function main(_n,_min,_max) {\r\n        this.n = _n;\r\n        this.min = _min;\r\n        this.max = _max;\r\n        this.result = [];\r\n    }\r\n\r\n    main.prototype.getRandomNumber = function() {\r\n        return Math.random()*this.max;\r\n    }\r\n\r\n    /**\r\n     * check if this num is in this.result\r\n     * @param  {number} num number to check\r\n     * @return boolen       true for in ; false for not in\r\n     */\r\n    main.prototype.checkNumber = function(num) {\r\n        for (var i = 0; i < this.result.length; i++) {\r\n            if(this.result[i] == num){\r\n                return true;\r\n            }else{\r\n\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    main.prototype.getNNumber = function() {\r\n        while (this.result.length < this.n) {\r\n            let num = this.getRandomNumber();\r\n            if(\r\n                !this.checkNumber(num)&&\r\n                num>this.min&&\r\n                num<this.max\r\n            ){\r\n                this.result.push(num);\r\n            }else{\r\n\r\n            }\r\n        }\r\n\r\n        return this.result;\r\n    }\r\n\r\n    unnuo.Random = main;\r\n\r\n})()\r\n\nwindow.unnuo = window.unnuo || {};\r\n(function() {\r\n\r\n    function getMultiRandomNumber() {\r\n        if(arguments.length == 2){\r\n            \r\n        }\r\n    }\r\n\r\n})()\r\n\nwindow.unnuo = window.unnuo || {};\r\n(function() {\r\n\r\n    /**\r\n     * number {number} mines around\r\n     * isMine {boolean} is mine\r\n     */\r\n    function Mine(callback) {\r\n        this.number = 0;\r\n        this.isMine = false;\r\n        this.opened = false;\r\n        this.row = null;\r\n        this.col = null; // 创建的时候，给它记录位置\r\n        this.htmlDOM = document.createElement('div');\r\n        this.htmlDOM.className = 'mine';\r\n        this.className = '';\r\n    }\r\n\r\n    unnuo.Mine = Mine;\r\n\r\n})()\r\n\nwindow.unnuo = window.unnuo || {};\r\n(function() {\r\n\r\n    function mineSweep(_times, _container, _newBtn, _saveBtn) {\r\n\r\n        var history = JSON.parse(localStorage.getItem('unnnuoMineSweepHistory'))\r\n\r\n\r\n        if (history) {\r\n            this.times = history.times;\r\n            this.bombArray = history.bombArray;\r\n            this.openedAmount = history.opendAmount;\r\n            this.canplay = history.canplay;\r\n        } else if (typeof _times != 'number' || _times <= 0) {\r\n            return console.log('game init error');\r\n        } else {\r\n            this.times = _times;\r\n            this.bombArray = [];\r\n            this.opendAmount = 0;\r\n            this.canplay = true;\r\n        }\r\n        this.array = [];\r\n        this.container = document.getElementById(_container);\r\n        this.newBtn = document.getElementById(_newBtn);\r\n        this.saveBtn = document.getElementById(_saveBtn);\r\n        this.col = 40;\r\n        var gameWidth = window.innerWidth-40;\r\n        var size = gameWidth/this.col\r\n        var style = document.createElement('style');\r\n        style.innerHTML = `#mineSweep{width:${gameWidth}px;}.mine{width:${size}px;height:${size}px;line-height:${size}px}`;\r\n        document.head.appendChild(style);\r\n        this.row = 30 * this.times;\r\n        this.mineAmount = 220 * this.times;\r\n        this.AMOUNT = this.col * this.row;\r\n\r\n        /**\r\n         * create mine Data Array\r\n         * 2017/3/30 下午2:50:27\r\n         */\r\n        this.createGameData = function() {\r\n            for (var r = 0; r < this.row; r++) {\r\n                this.array[r] = [];\r\n                for (var c = 0; c < this.col; c++) {\r\n                    let mine = new unnuo.Mine();\r\n                    this.array[r][c] = mine;\r\n                    mine.row = r;\r\n                    mine.col = c;\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n\r\n        this.createHistoryGameData = function() {\r\n            for (var r = 0; r < this.row; r++) {\r\n                this.array[r] = [];\r\n                for (var c = 0; c < this.col; c++) {\r\n                    let mine = new unnuo.Mine();\r\n                    this.array[r][c] = history.array[r][c];\r\n                    mine.htmlDOM.className = history.array[r][c].className;\r\n                    this.array[r][c].htmlDOM = mine.htmlDOM;\r\n                    if(this.array[r][c].opened){\r\n                        this.array[r][c].htmlDOM.innerHTML = this.array[r][c].number;\r\n                    }\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n\r\n        /**\r\n         * create mine position\r\n         * 2017/3/31 下午1:37:38\r\n         */\r\n        this.createMinePosition = function() {\r\n            let times = 0;\r\n            while (times < this.mineAmount) {\r\n                let col = Math.round(Math.random() * (this.col - 1));\r\n                let row = Math.round(Math.random() * (this.row - 1));\r\n                let mine = this.array[row][col];\r\n                if (!mine.isMine) {\r\n                    mine.isMine = true;\r\n                    mine.htmlDOM.className += ' mine-bomb'; // delete\r\n                    this.bombArray.push({\r\n                        row: row,\r\n                        col: col\r\n                    })\r\n                    times++;\r\n                }\r\n            }\r\n            // this.array[this.bombArray[1].row][this.bombArray[1].col].htmlDOM.style.backgroundColor = '#f00';\r\n            return this;\r\n        }\r\n\r\n        /**\r\n         * calculate mine amout around this position\r\n         * 2017/3/31 下午1:39:01\r\n         */\r\n        this.calculateAround = function() {\r\n            for (var row = 0; row < this.array.length; row++) {\r\n                for (var col = 0; col < this.array[row].length; col++) {\r\n                    // 遍历中心点\r\n                    let temp = 0;\r\n                    if (this.array[row][col] && !this.array[row][col].isMine) {\r\n                        // 如果中心点存在，并且不是雷，则计算周边的雷数量，并设置中心的的innerHTML\r\n                        for (var i = -1; i < 2; i++) {\r\n                            if (this.array[row + i]) {\r\n                                for (var j = -1; j < 2; j++) {\r\n                                    // 遍历周围检测点\r\n                                    if (this.array[row + i][col + j] && this.array[row + i][col + j].isMine) {\r\n                                        // 如果检测点存在，并且为雷，并且检测点不是中心点\r\n                                        temp++;\r\n                                    }\r\n                                }\r\n\r\n                            }\r\n                        }\r\n                        this.array[row][col].number = temp;\r\n                    }\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n\r\n        this.sweep = function(point) {\r\n            if (point.isMine) {\r\n                // bomb\r\n                alert('Game Over');\r\n                this.canplay = false;\r\n\r\n            } else {\r\n\r\n                point.opened = true;\r\n                this.opendAmount++;\r\n                if (this.opendAmount + this.mineAmount >= this.AMOUNT) {\r\n                    console.log('Success');\r\n                    this.canplay = false;\r\n                }\r\n\r\n                point.htmlDOM.innerHTML = point.number;\r\n                point.htmlDOM.className += ' opened has' + point.number;\r\n                // 增加扫雷成功之后的方法，更改样式，添加特效\r\n\r\n                if (point.number == 0) {\r\n                    // 如果不是雷，并且周围没有雷\r\n                    for (var i = -1; i < 2; i++) {\r\n                        if (this.array[point.row + i]) {\r\n                            for (var j = -1; j < 2; j++) {\r\n                                if (this.array[point.row + i][point.col + j] && !this.array[point.row + i][point.col + j].opened) {\r\n                                    this.sweep(this.array[point.row + i][point.col + j]);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * 给各个点绑定上事件处理器\r\n         * 2017/3/31 下午2:53:31\r\n         */\r\n        this.handle = function() {\r\n            // 给各个点绑定上事件处理器\r\n            for (var row = 0; row < this.array.length; row++) {\r\n                for (var col = 0; col < this.array[row].length; col++) {\r\n                    let point = this.array[row][col];\r\n                    this.array[row][col].htmlDOM.addEventListener('click', function() {\r\n                        if (this.canplay) {\r\n                            this.sweep(point);\r\n                        }\r\n                    }.bind(this));\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n\r\n        this.render = function() {\r\n            for (var r = 0; r < this.row; r++) {\r\n                for (var c = 0; c < this.col; c++) {\r\n                    this.container.appendChild(this.array[r][c].htmlDOM)\r\n                }\r\n            }\r\n        }\r\n\r\n        this.newBtn.onclick = function() {\r\n            // 开始方法\r\n            alert('New Game')\r\n            this.container.innerHTML = '';\r\n            localStorage.removeItem('unnnuoMineSweepHistory');\r\n            this.createGameData().createMinePosition().calculateAround().handle().render();\r\n\r\n        }.bind(this)\r\n\r\n        this.saveBtn.onclick = function() {\r\n            // 保存游戏状态\r\n            // var insertData =\r\n            for (var r = 0; r < this.row; r++) {\r\n                for (var c = 0; c < this.col; c++) {\r\n                    this.array[r][c].className = this.array[r][c].htmlDOM.className;\r\n                }\r\n            }\r\n            localStorage.setItem('unnnuoMineSweepHistory', JSON.stringify({\r\n                times: this.times,\r\n                array: this.array,\r\n                bombArray: this.bombArray,\r\n                openedAmount: this.opendAmount,\r\n                canplay: this.canplay\r\n            }))\r\n        }.bind(this)\r\n\r\n        if(history){\r\n            // this.createHistoryGameData().createMinePosition().calculateAround().handle().render();\r\n            this.createHistoryGameData().handle().render();\r\n        }else{\r\n            this.createGameData().createMinePosition().calculateAround().handle().render();\r\n        }\r\n\r\n    }\r\n\r\n    unnuo.mineSweep = mineSweep;\r\n\r\n})()\r\nnew unnuo.mineSweep(15, 'mineSweep', 'new', 'save');\r\n"]}