{"version":3,"sources":["lib/mineSweep.js"],"names":["window","unnuo","mineSweep","_times","_container","_newBtn","_saveBtn","history","JSON","parse","localStorage","getItem","this","times","bombArray","openedAmount","opendAmount","canplay","console","log","array","container","document","getElementById","newBtn","saveBtn","col","gameWidth","innerWidth","size","style","createElement","innerHTML","head","appendChild","row","mineAmount","AMOUNT","createGameData","r","c","mine","Mine","createHistoryGameData","htmlDOM","className","opened","number","createMinePosition","Math","round","random","isMine","push","calculateAround","length","temp","i","j","sweep","point","alert","handle","_this","addEventListener","bind","render","onclick","removeItem","setItem","stringify"],"mappings":"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","file":"mineSweep.min.js","sourcesContent":["window.unnuo = window.unnuo || {};\r\n(function() {\r\n\r\n    function mineSweep(_times, _container, _newBtn, _saveBtn) {\r\n\r\n        var history = JSON.parse(localStorage.getItem('unnnuoMineSweepHistory'))\r\n\r\n\r\n        if (history) {\r\n            this.times = history.times;\r\n            this.bombArray = history.bombArray;\r\n            this.openedAmount = history.opendAmount;\r\n            this.canplay = history.canplay;\r\n        } else if (typeof _times != 'number' || _times <= 0) {\r\n            return console.log('game init error');\r\n        } else {\r\n            this.times = _times;\r\n            this.bombArray = [];\r\n            this.opendAmount = 0;\r\n            this.canplay = true;\r\n        }\r\n        this.array = [];\r\n        this.container = document.getElementById(_container);\r\n        this.newBtn = document.getElementById(_newBtn);\r\n        this.saveBtn = document.getElementById(_saveBtn);\r\n        this.col = 40;\r\n        var gameWidth = window.innerWidth-40;\r\n        var size = gameWidth/this.col\r\n        var style = document.createElement('style');\r\n        style.innerHTML = `#mineSweep{width:${gameWidth}px;}.mine{width:${size}px;height:${size}px;line-height:${size}px}`;\r\n        document.head.appendChild(style);\r\n        this.row = 30 * this.times;\r\n        this.mineAmount = 220 * this.times;\r\n        this.AMOUNT = this.col * this.row;\r\n\r\n        /**\r\n         * create mine Data Array\r\n         * 2017/3/30 下午2:50:27\r\n         */\r\n        this.createGameData = function() {\r\n            for (var r = 0; r < this.row; r++) {\r\n                this.array[r] = [];\r\n                for (var c = 0; c < this.col; c++) {\r\n                    let mine = new unnuo.Mine();\r\n                    this.array[r][c] = mine;\r\n                    mine.row = r;\r\n                    mine.col = c;\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n\r\n        this.createHistoryGameData = function() {\r\n            for (var r = 0; r < this.row; r++) {\r\n                this.array[r] = [];\r\n                for (var c = 0; c < this.col; c++) {\r\n                    let mine = new unnuo.Mine();\r\n                    this.array[r][c] = history.array[r][c];\r\n                    mine.htmlDOM.className = history.array[r][c].className;\r\n                    this.array[r][c].htmlDOM = mine.htmlDOM;\r\n                    if(this.array[r][c].opened){\r\n                        this.array[r][c].htmlDOM.innerHTML = this.array[r][c].number;\r\n                    }\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n\r\n        /**\r\n         * create mine position\r\n         * 2017/3/31 下午1:37:38\r\n         */\r\n        this.createMinePosition = function() {\r\n            let times = 0;\r\n            while (times < this.mineAmount) {\r\n                let col = Math.round(Math.random() * (this.col - 1));\r\n                let row = Math.round(Math.random() * (this.row - 1));\r\n                let mine = this.array[row][col];\r\n                if (!mine.isMine) {\r\n                    mine.isMine = true;\r\n                    mine.htmlDOM.className += ' mine-bomb'; // delete\r\n                    this.bombArray.push({\r\n                        row: row,\r\n                        col: col\r\n                    })\r\n                    times++;\r\n                }\r\n            }\r\n            // this.array[this.bombArray[1].row][this.bombArray[1].col].htmlDOM.style.backgroundColor = '#f00';\r\n            return this;\r\n        }\r\n\r\n        /**\r\n         * calculate mine amout around this position\r\n         * 2017/3/31 下午1:39:01\r\n         */\r\n        this.calculateAround = function() {\r\n            for (var row = 0; row < this.array.length; row++) {\r\n                for (var col = 0; col < this.array[row].length; col++) {\r\n                    // 遍历中心点\r\n                    let temp = 0;\r\n                    if (this.array[row][col] && !this.array[row][col].isMine) {\r\n                        // 如果中心点存在，并且不是雷，则计算周边的雷数量，并设置中心的的innerHTML\r\n                        for (var i = -1; i < 2; i++) {\r\n                            if (this.array[row + i]) {\r\n                                for (var j = -1; j < 2; j++) {\r\n                                    // 遍历周围检测点\r\n                                    if (this.array[row + i][col + j] && this.array[row + i][col + j].isMine) {\r\n                                        // 如果检测点存在，并且为雷，并且检测点不是中心点\r\n                                        temp++;\r\n                                    }\r\n                                }\r\n\r\n                            }\r\n                        }\r\n                        this.array[row][col].number = temp;\r\n                    }\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n\r\n        this.sweep = function(point) {\r\n            if (point.isMine) {\r\n                // bomb\r\n                alert('Game Over');\r\n                this.canplay = false;\r\n\r\n            } else {\r\n\r\n                point.opened = true;\r\n                this.opendAmount++;\r\n                if (this.opendAmount + this.mineAmount >= this.AMOUNT) {\r\n                    console.log('Success');\r\n                    this.canplay = false;\r\n                }\r\n\r\n                point.htmlDOM.innerHTML = point.number;\r\n                point.htmlDOM.className += ' opened has' + point.number;\r\n                // 增加扫雷成功之后的方法，更改样式，添加特效\r\n\r\n                if (point.number == 0) {\r\n                    // 如果不是雷，并且周围没有雷\r\n                    for (var i = -1; i < 2; i++) {\r\n                        if (this.array[point.row + i]) {\r\n                            for (var j = -1; j < 2; j++) {\r\n                                if (this.array[point.row + i][point.col + j] && !this.array[point.row + i][point.col + j].opened) {\r\n                                    this.sweep(this.array[point.row + i][point.col + j]);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * 给各个点绑定上事件处理器\r\n         * 2017/3/31 下午2:53:31\r\n         */\r\n        this.handle = function() {\r\n            // 给各个点绑定上事件处理器\r\n            for (var row = 0; row < this.array.length; row++) {\r\n                for (var col = 0; col < this.array[row].length; col++) {\r\n                    let point = this.array[row][col];\r\n                    this.array[row][col].htmlDOM.addEventListener('click', function() {\r\n                        if (this.canplay) {\r\n                            this.sweep(point);\r\n                        }\r\n                    }.bind(this));\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n\r\n        this.render = function() {\r\n            for (var r = 0; r < this.row; r++) {\r\n                for (var c = 0; c < this.col; c++) {\r\n                    this.container.appendChild(this.array[r][c].htmlDOM)\r\n                }\r\n            }\r\n        }\r\n\r\n        this.newBtn.onclick = function() {\r\n            // 开始方法\r\n            alert('New Game')\r\n            this.container.innerHTML = '';\r\n            localStorage.removeItem('unnnuoMineSweepHistory');\r\n            this.createGameData().createMinePosition().calculateAround().handle().render();\r\n\r\n        }.bind(this)\r\n\r\n        this.saveBtn.onclick = function() {\r\n            // 保存游戏状态\r\n            // var insertData =\r\n            for (var r = 0; r < this.row; r++) {\r\n                for (var c = 0; c < this.col; c++) {\r\n                    this.array[r][c].className = this.array[r][c].htmlDOM.className;\r\n                }\r\n            }\r\n            localStorage.setItem('unnnuoMineSweepHistory', JSON.stringify({\r\n                times: this.times,\r\n                array: this.array,\r\n                bombArray: this.bombArray,\r\n                openedAmount: this.opendAmount,\r\n                canplay: this.canplay\r\n            }))\r\n        }.bind(this)\r\n\r\n        if(history){\r\n            // this.createHistoryGameData().createMinePosition().calculateAround().handle().render();\r\n            this.createHistoryGameData().handle().render();\r\n        }else{\r\n            this.createGameData().createMinePosition().calculateAround().handle().render();\r\n        }\r\n\r\n    }\r\n\r\n    unnuo.mineSweep = mineSweep;\r\n\r\n})()\r\nnew unnuo.mineSweep(15, 'mineSweep', 'new', 'save');\r\n"]}